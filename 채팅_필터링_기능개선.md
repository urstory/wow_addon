# FoxChat 채팅 필터링 기능 개선 계획

## 개요
FoxChat의 채팅 필터링 기능을 개선하여 채널별로 개별적인 필터링 설정을 지원하고, 토스트 알림 시간을 사용자가 설정할 수 있도록 개선합니다.

## 현재 상태 분석

### 현재 구조
- **필터링 문구**: 전체 채팅에 공통 적용
- **무시할 문구**: 전체 채팅에 공통 적용
- **채널 선택**: 체크박스로 필터링할 채널 선택 (길드, 공개, 파티/공격대, 파티찾기)
- **강조 스타일**: 공통 설정
- **토스트 위치**: 고정된 표시 시간 (약 3초)

### 문제점
1. 모든 채널이 동일한 필터링 문구를 사용
2. 채널별로 다른 필터링 요구사항을 충족할 수 없음
3. 토스트 알림 시간을 사용자가 조절할 수 없음

## 개선 방안

### 1. 채널별 필터링 설정 분리

#### UI 구조 변경 (자동탭 스타일)
```
채팅 필터링 탭
├── 상단: 공통 설정 영역
│   ├── 채팅 필터링 사용 (체크박스)
│   ├── 소리 알림 재생 (체크박스)
│   ├── 미니맵 버튼 표시 (체크박스)
│   ├── 강조 스타일 (색상 선택)
│   ├── 토스트 위치 (X, Y 좌표)
│   └── 토스트 표시 시간 (슬라이더: 1초~10초)
├── 구분선
└── 하단: 채널별 설정 영역
    ├── 좌측 메뉴 패널 (자동탭 스타일)
    │   ├── 길드
    │   ├── 공개
    │   ├── 파티/공격대
    │   └── 파티찾기
    └── 우측 컨텐츠 패널
        ├── [채널명] 필터링 사용 (체크박스)
        ├── 필터링 문구 (TextArea)
        └── 무시할 문구 (TextArea)
```

#### 데이터 구조 변경
```lua
FoxChatDB = {
    -- 기존 공통 설정
    filterEnabled = true,
    soundEnabled = true,
    toastEnabled = true,
    toastPosition = {x = 0, y = -320},
    toastDuration = 3,  -- 새로운 설정 (초 단위)

    -- 채널별 필터링 설정 (새로운 구조)
    channelFilters = {
        GUILD = {
            enabled = true,
            keywords = "상종, 하종, 폭스아이, 우르사, 페이, 출구몸",
            ignoreKeywords = ""
        },
        SAY = {
            enabled = true,
            keywords = "비만렙, 58, 57, 명중, 후문, 오브부, 경험치",
            ignoreKeywords = "판매, 거래"
        },
        PARTY = {
            enabled = true,
            keywords = "마우린, 해적, 힐드, 캠프, 울다만",
            ignoreKeywords = ""
        },
        LFG = {
            enabled = true,
            keywords = "입타, 출구물소환사, 돌격남",
            ignoreKeywords = ""
        }
    },

    -- 기존 설정 유지 (하위 호환성)
    keywords = "",  -- 마이그레이션 후 제거
    ignoreKeywords = ""  -- 마이그레이션 후 제거
}
```

### 2. UI 구현 세부사항

#### 2.1 공통 설정 영역 (상단)
- **위치**: 채팅 필터링 탭 최상단
- **구성 요소**:
  - 채팅 필터링 사용 체크박스
  - 소리 알림 재생 체크박스
  - 미니맵 버튼 표시 체크박스
  - 강조 스타일 색상 선택 버튼
  - 토스트 위치 설정 (X, Y 입력 필드)
  - 토스트 표시 시간 슬라이더 (1~10초, 0.5초 단위)
- **특징**: 모든 채널에 공통으로 적용되는 설정

#### 2.2 채널별 설정 영역 (하단)
- **좌측 메뉴 패널** (자동탭과 동일한 스타일)
  - 너비: 100px
  - 버튼 높이: 30px
  - 선택된 메뉴 하이라이트 (황금색)
  - 호버 효과

- **우측 컨텐츠 패널**
  - 각 채널별 독립된 설정
  - 채널 필터링 활성화 체크박스
  - 필터링 문구 TextArea (520x100, 스크롤바 포함)
  - 무시할 문구 TextArea (520x100, 스크롤바 포함)
  - 최대 글자수: 500자

#### 2.3 구분선
- 공통 설정과 채널별 설정을 시각적으로 구분
- 수평 구분선 또는 프레임 배경색 차이로 구현

### 3. 구현 단계

#### Phase 1: 데이터 마이그레이션 (1일)
1. 기존 설정 백업
2. 새로운 데이터 구조로 변환
3. 하위 호환성 유지 코드 작성

#### Phase 2: UI 레이아웃 구현 (2일)
1. 공통 설정 영역 구현 (상단)
2. 좌측 메뉴 패널 구현 (자동탭 스타일)
3. 우측 컨텐츠 패널 구현 (채널별 설정)
4. TextArea 컴포넌트 재사용
5. 토스트 시간 슬라이더 추가

#### Phase 3: 로직 구현 (2일)
1. 채널별 필터링 로직 수정
2. 설정 저장/불러오기 로직 업데이트
3. 토스트 표시 시간 동적 적용

#### Phase 4: 테스트 및 최적화 (1일)
1. 각 채널별 필터링 동작 테스트
2. 토스트 시간 설정 테스트
3. 성능 최적화

### 4. 구현 코드 예시

#### 공통 설정 영역 생성
```lua
local function CreateCommonSettings(parent)
    local commonFrame = CreateFrame("Frame", nil, parent)
    commonFrame:SetSize(650, 150)
    commonFrame:SetPoint("TOPLEFT", parent, "TOPLEFT", 10, -10)

    -- 체크박스들 (한 줄로 배치)
    local filterEnabled = CreateFrame("CheckButton", nil, commonFrame)
    filterEnabled:SetSize(24, 24)
    filterEnabled:SetPoint("TOPLEFT", 0, 0)
    -- ... 체크박스 설정

    local soundEnabled = CreateFrame("CheckButton", nil, commonFrame)
    soundEnabled:SetSize(24, 24)
    soundEnabled:SetPoint("LEFT", filterEnabled, "RIGHT", 150, 0)

    local minimapButton = CreateFrame("CheckButton", nil, commonFrame)
    minimapButton:SetSize(24, 24)
    minimapButton:SetPoint("LEFT", soundEnabled, "RIGHT", 150, 0)

    -- 토스트 설정
    local toastLabel = commonFrame:CreateFontString(nil, "OVERLAY", "GameFontNormal")
    toastLabel:SetPoint("TOPLEFT", filterEnabled, "BOTTOMLEFT", 0, -30)
    toastLabel:SetText("토스트 위치:")

    -- 토스트 시간 슬라이더
    local durationSlider = CreateFrame("Slider", "FoxChatToastDuration", commonFrame, "OptionsSliderTemplate")
    durationSlider:SetPoint("TOPLEFT", toastLabel, "BOTTOMLEFT", 0, -30)
    durationSlider:SetMinMaxValues(1, 10)
    durationSlider:SetValueStep(0.5)
    durationSlider:SetWidth(200)

    -- 구분선
    local separator = CreateSeparator(commonFrame)
    separator:SetPoint("TOPLEFT", durationSlider, "BOTTOMLEFT", -10, -20)

    return commonFrame
end
```

#### 자동탭 스타일 채널 메뉴 구현
```lua
local function CreateChannelFilterMenu(parent)
    -- 좌측 메뉴 패널
    local leftMenuPanel = CreateFrame("Frame", nil, parent, "BackdropTemplate")
    leftMenuPanel:SetSize(100, 300)
    leftMenuPanel:SetPoint("TOPLEFT", parent, "TOPLEFT", 10, -170)
    leftMenuPanel:SetBackdrop({
        bgFile = "Interface\\DialogFrame\\UI-DialogBox-Background",
        edgeFile = "Interface\\DialogFrame\\UI-DialogBox-Border",
        edgeSize = 1,
        insets = {left = 1, right = 1, top = 1, bottom = 1}
    })

    -- 우측 컨텐츠 패널
    local rightContentPanel = CreateFrame("Frame", nil, parent)
    rightContentPanel:SetSize(530, 300)
    rightContentPanel:SetPoint("TOPLEFT", leftMenuPanel, "TOPRIGHT", 5, 0)

    -- 메뉴 데이터
    local channels = {
        {id = "GUILD", name = "길드"},
        {id = "SAY", name = "공개"},
        {id = "PARTY", name = "파티/공격대"},
        {id = "LFG", name = "파티찾기"}
    }

    local menuButtons = {}
    local contentFrames = {}
    local currentChannel = "GUILD"

    -- 각 채널별 메뉴 버튼 생성
    for i, channel in ipairs(channels) do
        local button = CreateFrame("Button", nil, leftMenuPanel)
        button:SetSize(96, 30)
        button:SetPoint("TOPLEFT", leftMenuPanel, "TOPLEFT", 2, -10 - (i-1) * 35)

        local text = button:CreateFontString(nil, "OVERLAY", "GameFontNormal")
        text:SetPoint("CENTER")
        text:SetText(channel.name)
        button.text = text

        -- 선택 효과
        local selected = button:CreateTexture(nil, "BACKGROUND")
        selected:SetAllPoints()
        selected:SetColorTexture(0.8, 0.6, 0.2, 0.3)
        selected:Hide()
        button.selected = selected

        -- 클릭 이벤트
        button:SetScript("OnClick", function(self)
            -- 모든 버튼 초기화
            for _, btn in pairs(menuButtons) do
                btn.selected:Hide()
                btn.text:SetTextColor(1, 1, 1, 1)
            end

            -- 현재 버튼 선택
            self.selected:Show()
            self.text:SetTextColor(1, 0.82, 0, 1)

            -- 컨텐츠 전환
            for _, frame in pairs(contentFrames) do
                frame:Hide()
            end
            contentFrames[channel.id]:Show()
            currentChannel = channel.id
        end)

        menuButtons[channel.id] = button

        -- 각 채널별 컨텐츠 프레임 생성
        contentFrames[channel.id] = CreateChannelContent(rightContentPanel, channel)
    end

    -- 첫 번째 채널 선택
    menuButtons["GUILD"]:GetScript("OnClick")(menuButtons["GUILD"])

    return leftMenuPanel, rightContentPanel
end

-- 채널별 컨텐츠 생성
local function CreateChannelContent(parent, channel)
    local frame = CreateFrame("Frame", nil, parent)
    frame:SetAllPoints()
    frame:Hide()

    -- 채널 필터링 사용 체크박스
    local enableCheckbox = CreateFrame("CheckButton", nil, frame)
    enableCheckbox:SetPoint("TOPLEFT", 10, -10)
    -- ... 체크박스 설정

    local enableLabel = frame:CreateFontString(nil, "OVERLAY", "GameFontNormal")
    enableLabel:SetPoint("LEFT", enableCheckbox, "RIGHT", 5, 0)
    enableLabel:SetText(channel.name .. " 채널 필터링 사용")

    -- 필터링 문구 TextArea
    local keywordsLabel = frame:CreateFontString(nil, "OVERLAY", "GameFontNormal")
    keywordsLabel:SetPoint("TOPLEFT", enableCheckbox, "BOTTOMLEFT", 0, -20)
    keywordsLabel:SetText("필터링 문구:")

    local keywordsArea = CreateTextArea(frame, 520, 100, 500)
    keywordsArea:SetPoint("TOPLEFT", keywordsLabel, "BOTTOMLEFT", 0, -5)

    -- 무시할 문구 TextArea
    local ignoreLabel = frame:CreateFontString(nil, "OVERLAY", "GameFontNormal")
    ignoreLabel:SetPoint("TOPLEFT", keywordsArea, "BOTTOMLEFT", 0, -20)
    ignoreLabel:SetText("무시할 문구:")

    local ignoreArea = CreateTextArea(frame, 520, 100, 500)
    ignoreArea:SetPoint("TOPLEFT", ignoreLabel, "BOTTOMLEFT", 0, -5)

    -- 데이터 로드 및 저장
    if FoxChatDB.channelFilters[channel.id] then
        enableCheckbox:SetChecked(FoxChatDB.channelFilters[channel.id].enabled)
        keywordsArea:SetText(FoxChatDB.channelFilters[channel.id].keywords or "")
        ignoreArea:SetText(FoxChatDB.channelFilters[channel.id].ignoreKeywords or "")
    end

    return frame
end
```

#### 전체 UI 통합
```lua
local function CreateChatFilterTab(parent, FoxChatDB, CreateTextArea, CreateSeparator)
    -- 1. 공통 설정 영역 생성 (상단)
    local commonSettings = CreateCommonSettings(parent)

    -- 2. 채널별 필터링 영역 생성 (하단)
    local leftMenu, rightContent = CreateChannelFilterMenu(parent)

    -- 3. 테스트 버튼 (우측 하단)
    local testButton = CreateFrame("Button", nil, parent, "UIPanelButtonTemplate")
    testButton:SetSize(100, 25)
    testButton:SetPoint("BOTTOMRIGHT", parent, "BOTTOMRIGHT", -20, 20)
    testButton:SetText("토스트 테스트")
    testButton:SetScript("OnClick", function()
        -- 토스트 미리보기 표시
        ShowToastPreview(FoxChatDB.toastDuration or 3)
    end)

    return parent
end
```

### 5. 예상 결과

#### 개선된 사용자 경험
1. **채널별 최적화**: 각 채널 특성에 맞는 필터링 설정
   - 길드: 길드 활동 관련 키워드
   - 공개: 거래, 파티 모집 관련
   - 파티/공격대: 던전, 레이드 관련
   - 파티찾기: 모집 관련 키워드

2. **유연한 알림**: 사용자가 토스트 표시 시간 조절
   - 빠른 확인이 필요한 경우: 1-2초
   - 자세한 확인이 필요한 경우: 5-10초

3. **직관적인 UI**: 채널별로 구분된 명확한 설정 화면

### 6. 고려사항

#### 성능 최적화
- 채널별 필터링 로직을 효율적으로 구현
- 불필요한 문자열 처리 최소화
- 메모리 사용량 모니터링

#### 하위 호환성
- 기존 설정을 새 구조로 자동 마이그레이션
- 업데이트 후에도 기존 설정 유지

#### 사용성
- 채널 간 설정 복사 기능 추가 (선택사항)
- 설정 초기화 버튼 채널별로 제공
- 도움말 툴팁 추가

### 7. 일정

| 단계 | 작업 내용 | 예상 기간 |
|------|-----------|-----------|
| 1 | 데이터 구조 마이그레이션 | 1일 |
| 2 | UI 레이아웃 구현 | 2일 |
| 3 | 필터링 로직 구현 | 2일 |
| 4 | 테스트 및 디버깅 | 1일 |
| **총계** | | **6일** |

### 8. 테스트 계획

#### 기능 테스트
1. 각 채널별 필터링 독립 동작 확인
2. 토스트 시간 설정 변경 및 적용 확인
3. 설정 저장 및 불러오기 확인

#### 호환성 테스트
1. 기존 설정 마이그레이션 확인
2. 다양한 WoW 클라이언트 버전 테스트

#### 성능 테스트
1. 대량 메시지 처리 시 프레임 드롭 확인
2. 메모리 사용량 모니터링

## 결론
이 개선을 통해 FoxChat은 더욱 강력하고 유연한 채팅 필터링 도구가 될 것입니다. 사용자는 각 채널의 특성에 맞게 최적화된 필터링 설정을 할 수 있으며, 토스트 알림 시간도 자유롭게 조절할 수 있게 됩니다.