# WoW 애드온 EditBox 커서 위치 구현 방법

## 개요
WoW 애드온에서 EditBox(텍스트 입력 영역)의 커서 위치를 정확하게 제어하는 방법을 설명합니다.

## 구현 목표
- 텍스트를 클릭하면: 클릭한 위치에 커서가 위치
- 빈 공간을 클릭하면: 텍스트 끝에 커서가 위치
- 배경을 클릭해도 EditBox에 포커스 부여

## 구현 방법

### 1. EditBox와 배경 프레임 생성

```lua
-- 배경 프레임 생성
local background = CreateFrame("Frame", nil, parent, "BackdropTemplate")
background:SetSize(250, 60)
background:SetPoint("TOPLEFT", label, "BOTTOMLEFT", 0, -5)
background:SetBackdrop({
    bgFile = "Interface\\Tooltips\\UI-Tooltip-Background",
    edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
    tile = true, tileSize = 16, edgeSize = 16,
    insets = { left = 4, right = 4, top = 4, bottom = 4 }
})
background:SetBackdropColor(0, 0, 0, 0.8)

-- EditBox 생성
local editBox = CreateFrame("EditBox", nil, background)
editBox:SetSize(240, 50)
editBox:SetPoint("TOPLEFT", 10, -5)
editBox:SetAutoFocus(false)
editBox:SetMultiLine(true)
editBox:SetMaxLetters(255)
editBox:SetFontObject(GameFontHighlight)
editBox:SetText("초기 텍스트")
```

### 2. 커서 위치 제어 구현

```lua
-- EditBox 클릭 영역 개선 - 배경을 클릭해도 EditBox에 포커스가 가도록
background:EnableMouse(true)
background:SetScript("OnMouseDown", function(self, button)
    if button == "LeftButton" then
        editBox:SetFocus()
        -- 커서 위치는 건드리지 않음
    end
end)

-- EditBox의 기본 마우스 클릭 동작을 사용 (커서가 클릭한 위치로 이동)
-- SetScript를 사용하지 않고 EditBox의 기본 동작을 활용
```

### 3. 핵심 원리

#### 배경 클릭 처리
- `background:EnableMouse(true)`: 배경이 마우스 이벤트를 받을 수 있도록 설정
- `background:SetScript("OnMouseDown", ...)`: 배경 클릭 시 EditBox에 포커스 부여
- **중요**: `SetCursorPosition()`을 호출하지 않음으로써 커서 위치 유지

#### EditBox 클릭 처리
- EditBox는 기본적으로 클릭한 위치에 커서를 배치하는 기능 내장
- `OnMouseDown` 이벤트를 오버라이드하지 않고 기본 동작 사용
- WoW의 내장 EditBox는 텍스트 위치 계산을 자동으로 처리

### 4. 실제 구현 예제 (FoxChat 애드온)

```lua
-- 광고 메시지 EditBox 구현
local adMessageBackground = CreateFrame("Frame", nil, tab3, "BackdropTemplate")
adMessageBackground:SetSize(250, 60)
adMessageBackground:SetPoint("TOPLEFT", adMessageHelp, "BOTTOMLEFT", 0, -5)
adMessageBackground:SetBackdrop({
    bgFile = "Interface\\Tooltips\\UI-Tooltip-Background",
    edgeFile = "Interface\\Tooltips\\UI-Tooltip-Border",
    tile = true, tileSize = 16, edgeSize = 16,
    insets = { left = 4, right = 4, top = 4, bottom = 4 }
})
adMessageBackground:SetBackdropColor(0, 0, 0, 0.8)

adMessageEditBox = CreateFrame("EditBox", "FoxChatAdMessageEditBox", adMessageBackground)
adMessageEditBox:SetSize(240, 50)
adMessageEditBox:SetPoint("TOPLEFT", 10, -5)
adMessageEditBox:SetAutoFocus(false)
adMessageEditBox:SetMultiLine(true)
adMessageEditBox:SetMaxLetters(255)
adMessageEditBox:SetFontObject(GameFontHighlight)
adMessageEditBox:SetText((FoxChatDB and FoxChatDB.adMessage) or "")

-- EditBox 클릭 영역 개선 - 배경을 클릭해도 EditBox에 포커스가 가도록
adMessageBackground:EnableMouse(true)
adMessageBackground:SetScript("OnMouseDown", function(self, button)
    if button == "LeftButton" then
        adMessageEditBox:SetFocus()
        -- 커서 위치는 건드리지 않음
    end
end)

-- EditBox의 기본 마우스 클릭 동작을 사용 (커서가 클릭한 위치로 이동)

adMessageEditBox:SetScript("OnTextChanged", function(self)
    if FoxChatDB then
        FoxChatDB.adMessage = self:GetText()
        -- 광고 메시지 변경 시 버튼 상태 업데이트
        if tab3.UpdateAdStartButton then
            tab3.UpdateAdStartButton()
        end
        if FoxChat and FoxChat.UpdateAdButton then
            FoxChat:UpdateAdButton()
        end
    end
end)
```

## 주의사항

1. **SetCursorPosition 사용 금지**: 배경 클릭 시 `SetCursorPosition`을 호출하면 의도하지 않은 위치로 커서가 이동
2. **OnMouseDown vs OnClick**: EditBox의 기본 커서 위치 지정은 `OnMouseDown`에서 처리되므로, 이를 오버라이드하지 않음
3. **멀티라인 EditBox**: `SetMultiLine(true)`를 사용할 때도 동일한 원리 적용

## 장점

- 사용자가 기대하는 자연스러운 동작
- 추가적인 커서 위치 계산 불필요
- WoW의 기본 EditBox 동작 활용으로 안정성 보장
- 코드가 간결하고 유지보수 용이

## 결론

WoW EditBox의 기본 동작을 최대한 활용하면서, 배경 클릭 시에만 추가 처리를 하는 방식으로 구현합니다. 이는 가장 간단하면서도 효과적인 방법입니다.