# FoxChat Update Log

## Version 3.1 - Leadership Greetings Update (2025-09-29)

### 👑 리더 전용 인사말 시스템
#### 새로운 리더 인사 기능
- **파티장 전용 인사말**
  - 파티장일 때만 작동하는 전용 메시지
  - 모든 줄을 순서대로 전송 (랜덤 아님)
  - PARTY 채널로 자동 전송

- **공대장 전용 인사말**
  - 공대장일 때만 작동하는 전용 메시지
  - 모든 줄을 순서대로 전송
  - RAID 채널로 전송 (/공)
  - GetRaidRosterInfo를 사용한 정확한 권한 체크

- **우선순위 시스템**
  - 리더 권한이 있으면 리더 전용 메시지 사용
  - 리더가 아니면 일반 랜덤 인사말 사용
  - 자동으로 권한 감지 및 적용

### 🎨 UI 개선 사항
#### 인사 메뉴 레이아웃 개선
- **2열 레이아웃 적용**
  - 상단: 일반 인사말 (내가 참가 / 다른 사람 참가)
  - 하단: 리더 전용 인사말 (파티장 / 공대장)
  - 공간 활용 최적화

- **입력창 크기 조정**
  - 일반 인사말: 240x75 픽셀
  - 리더 인사말: 500x75 픽셀 (전체 너비)
  - 3줄 텍스트 완벽 표시

### 🚀 기능 개선
#### 공격대 지원 강화
- GROUP_ROSTER_UPDATE 이벤트 개선
- 파티와 공격대 모두에서 멤버 추가/제거 감지
- 공격대 멤버 추적 시스템 구현
- 크로스 서버 플레이어 이름 정규화

#### 광고 버튼 개선
- **우클릭 동작 변경**
  - 이전: 광고 중지
  - 현재: 설정창 열기 (광고 탭 자동 선택)
  - 툴팁 메시지 업데이트

### 🐛 버그 수정
- CreateSeparator 함수 오류 수정
- 공대장 판단 로직 개선 (UnitIsGroupLeader → GetRaidRosterInfo)
- 공대장 인사말 미출력 문제 해결
- UI 요소가 프레임을 벗어나는 문제 수정

### 📝 채널 변경
- 공대장 인사말: RAID_WARNING(경보) → RAID(공) 채널로 변경

### 🔧 기술적 개선
- GetPlainName 함수 추가 (서버명 제거)
- GetMyRaidRole 함수 구현 (정확한 공대 권한 체크)
- 상세한 디버그 로그 추가
- 코드 구조 최적화

---

## Version 3.0 - Major Update (2025)

### 🎨 UI 개선
#### 자동 탭 완전 개편
- 좌측 메뉴 네비게이션 방식으로 UI 재구성
- 4개의 주요 메뉴: 거래, 인사, 응답, 주사위
- 각 메뉴별 독립된 컨텐츠 영역
- 메뉴 선택 시 하이라이트 효과 및 색상 변경
- 컨텐츠 영역 크기 최적화 (540x430)

### ⚔️ 자동응답 시스템
#### 스마트 자동응답 구현
- **전투 중 자동응답**
  - 전투 상황 자동 감지
  - 사용자 정의 메시지 설정 가능
  - 파티/공대원에게는 응답하지 않음

- **인던 중 자동응답**
  - 인스턴스 진입 자동 감지
  - 별도의 인던용 메시지 설정
  - 같은 파티/공대원 자동 제외

- **AFK/DND 자동응답**
  - 항상 활성화 (체크박스 제거)
  - 각 상태별 다른 메시지

- **쿨다운 시스템**
  - 발신자별 개별 쿨다운 관리
  - 기본 5분, 사용자 설정 가능
  - 스팸 방지 기능

- **그룹 멤버 감지**
  - 파티/공대원 자동 인식
  - 서버명 처리 개선
  - 디버그 모드 지원 (`/fcdbg autoreply`)

### 🎲 주사위 자동 집계
#### 완전히 새로운 주사위 시스템
- **자동 집계 기능**
  - 파티/공대 주사위 자동 감지
  - 설정된 시간 후 자동 결과 발표
  - 한국어/영어 클라이언트 모두 지원

- **설정 옵션**
  - 집계 시간: 10/15/20/30/45/60초 (기본: 10초)
  - 출력 채널: 파티/공대 또는 나에게만 (기본: 나에게만)
  - 우승자 표시: 상위 N명 설정 (기본: 1명)

- **결과 출력**
  - 파티/공대 자동 감지하여 적절한 채널로 전송
  - 나에게만 선택 시 시스템 메시지로 출력
  - 깔끔한 결과 포맷

### 👋 파티 자동인사
#### 향상된 인사 시스템
- **변수 지원**
  - `{me}`: 내 캐릭터 이름으로 자동 치환
  - `{name}`: 참가자 이름으로 자동 치환

- **개선된 메시지 시스템**
  - 여러 줄 메시지 지원 (줄바꿈으로 구분)
  - 랜덤 메시지 선택
  - 빈 줄 자동 필터링

- **설정 키 통합**
  - 이전 설정과의 호환성 문제 해결
  - 새로운 통합 키 시스템

### 🛠️ 기술적 개선
- WoW Classic 호환성 향상
- BackdropTemplate 이슈 해결
- EditBox 래핑으로 SetBackdrop 오류 수정
- 설정 저장/불러오기 시스템 개선
- 디버그 명령어 추가 및 개선

### 🐛 버그 수정
- 자동 탭이 비어 보이는 문제 해결
- 중복 코드 제거 및 최적화
- 파티원 인식 오류 수정
- 설정값 불일치 문제 해결
- Lua 문법 오류 수정

### 📝 기본값 변경
- 주사위 집계 시간: 20초 → 10초
- 주사위 출력: 파티/공대 → 나에게만
- 상위 표시: 3명 → 1명
- 자동응답 쿨다운: 5분 (유지)

### 🔧 명령어 추가
- `/fcdbg autoreply` - 자동응답 디버그 모드 토글
- `/fcdbg settings` - 현재 설정 표시
- `/fcdbg messages` - 인사말 메시지 표시
- `/fcdbg reply` - 자동응답 메시지 표시
- `/fcdbg test combat` - 전투 시뮬레이션

---

## 업데이트 방법
1. 기존 FoxChat 폴더를 백업
2. 새 버전의 FoxChat 폴더로 교체
3. 게임 내에서 `/reload` 실행
4. 자동 탭에서 새로운 기능 확인

## 주의사항
- 설정이 초기화될 수 있으므로 중요한 설정은 미리 메모
- 새로운 UI에서 기존 설정을 다시 확인 필요
- 문제 발생 시 `/fcdbg reset`으로 설정 초기화 가능

## 개발자
우르사 (20주년 하드코어 클래식 서버, Fox and Wolf 길드)