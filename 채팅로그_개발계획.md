# FoxChat ì±„íŒ… ë¡œê·¸ ê¸°ëŠ¥ ê°œë°œ ê³„íš (ì„±ëŠ¥ ìµœì í™” ë²„ì „)

## 1. ê°œìš”
FoxChat ì—ë“œì˜¨ì˜ ìë™í™” íƒ­ì— ì±„íŒ… ë¡œê·¸ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ê·“ì†ë§ê³¼ íŒŒí‹° ëŒ€í™” ë‚´ìš©ì„ ì¼ìë³„ë¡œ ì €ì¥í•˜ê³  ì¡°íšŒí•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„
**WoW í´ë˜ì‹ í™˜ê²½ì—ì„œ ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì„ ìµœìš°ì„ ìœ¼ë¡œ ì„¤ê³„**

## 2. í•µì‹¬ ì„¤ê³„ ì›ì¹™

### 2.1 ì„±ëŠ¥ ìµœì í™” ì›ì¹™
- **í•«íŒ¨ìŠ¤ì—ì„œ ë¬¸ìì—´ í¬ë§· ìµœì†Œí™”**: ë¡œê·¸ ì €ì¥ ì‹œ ìˆ«ì íƒ€ì„ìŠ¤íƒ¬í”„ë§Œ ì €ì¥, UIì—ì„œë§Œ í¬ë§·
- **í‚¤/í•„ë“œ ì¶•ì•½**: SavedVariables í¬ê¸° ìµœì†Œí™”ë¥¼ ìœ„í•´ ì§§ì€ í‚¤ ì‚¬ìš©
- **ê°€ìƒ ìŠ¤í¬ë¡¤ ì ìš©**: ë³´ì´ëŠ” ë¶€ë¶„ë§Œ ë Œë”ë§
- **ë¹„ë™ê¸° ê²€ìƒ‰**: ëŒ€ëŸ‰ ë°ì´í„° ê²€ìƒ‰ ì‹œ í”„ë ˆì„ ë“œë¡­ ë°©ì§€
- **ë³´ê´€/ì²­ì†Œ ìµœì†Œ ì‹¤í–‰**: ë¡œê·¸ì¸ ì‹œ ë˜ëŠ” ë‚ ì§œ ë³€ê²½ ì‹œ 1íšŒë§Œ

### 2.2 WoW í´ë˜ì‹ ì œì•½ì‚¬í•­ ëŒ€ì‘
- SavedVariablesëŠ” **/reload** ë˜ëŠ” **ë¡œê·¸ì•„ì›ƒ** ì‹œì—ë§Œ ë””ìŠ¤í¬ ì €ì¥
- ì• ë“œì˜¨ì€ ë¡œì»¬ íŒŒì¼ ì§ì ‘ ì €ì¥ ë¶ˆê°€ â†’ ë³µì‚¬ìš© íŒì—… ì œê³µ
- ìì • ì €ì¥ ê°œë… ì—†ìŒ â†’ ë©”ëª¨ë¦¬ì—ì„œë§Œ ë²„í‚· êµì²´

## 3. ë°ì´í„° êµ¬ì¡° (ìµœì í™”)

### 3.1 ì €ì¥ êµ¬ì¡°
```lua
FoxChatDB.chatLogs = {
  ["20241229"] = {  -- YYYYMMDD í˜•ì‹ (ì§§ê³  ì •ë ¬ ì‰¬ì›€)
    -- ì¶•ì•½ í‚¤: ts=íƒ€ì„ìŠ¤íƒ¬í”„, ch=ì±„ë„ì½”ë“œ, s=ë°œì‹ ì, t=ëŒ€ìƒ, m=ë©”ì‹œì§€, o=ë°œì‹ ì—¬ë¶€
    { ts=1735454121, ch=1, s="í”Œë ˆì´ì–´", t="ìƒëŒ€", m="ì•ˆë…•í•˜ì„¸ìš”", o=1 },
    { ts=1735454175, ch=3, s="íŒŒí‹°ì›", m="ë˜ì „ ê°€ì‹¤ë¶„?", o=0 },
  },
}

-- ì±„ë„ ì½”ë“œ ë§¤í•‘ (ì €ì¥ í¬ê¸° ìµœì†Œí™”)
-- 1: WHISPER_OUT (ë‚´ê°€ ë³´ë‚¸ ê·“ë§)
-- 2: WHISPER_IN  (ë°›ì€ ê·“ë§)
-- 3: PARTY
-- 4: RAID
-- 5: GUILD
-- 6: PARTY_LEADER
-- 7: RAID_LEADER
```

### 3.2 ì„¤ì • êµ¬ì¡°
```lua
FoxChatDB.chatLogConfig = {
    enabled = false,
    channels = {
        WHISPER = true,
        PARTY = true,
        RAID = false,   -- ê¸°ë³¸ OFF (ë¡œê·¸ í­ì¦ ë°©ì§€)
        GUILD = false,  -- ê¸°ë³¸ OFF
    },
    retentionDays = 7,  -- 1~30ì¼
    sessionTimeout = 1800,  -- 30ë¶„ (UI í‘œì‹œìš©)
}
```

## 4. UI êµ¬ì„± (Text Art)

### 4.1 ìë™í™” íƒ­ ë‚´ ìœ„ì¹˜
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ê´‘ê³  ì„¤ì •] [ì„ ì…ì] [íŒŒí‹° ìë™í™”] [ì£¼ì‚¬ìœ„] [ì±„íŒ… ë¡œê·¸] â†NEWâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ì±„íŒ… ë¡œê·¸ UI ë ˆì´ì•„ì›ƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì±„íŒ… ë¡œê·¸ ì„¤ì •                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¡ ì±„íŒ… ë¡œê·¸ ê¸°ëŠ¥ ì‚¬ìš©                                     â”‚
â”‚                                                            â”‚
â”‚ ë¡œê·¸ ëŒ€ìƒ ì±„ë„:                                           â”‚
â”‚ â˜‘ ê·“ì†ë§  â˜‘ íŒŒí‹°  â–¡ ê³µê²©ëŒ€  â–¡ ê¸¸ë“œ                     â”‚
â”‚                                                            â”‚
â”‚ ë³´ê´€ ê¸°ê°„: [â–¼ 7ì¼ ]  (ìµœëŒ€ 30ì¼)                        â”‚
â”‚ ì¼ë³„ ìµœëŒ€: [10000] ì¤„ (ë©”ëª¨ë¦¬ ë³´í˜¸)                       â”‚
â”‚                                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë¡œê·¸ ë³´ê¸°                                                  â”‚
â”‚                                                            â”‚
â”‚ [ì˜¤ëŠ˜] [ì–´ì œ] [ìµœê·¼7ì¼] [â—€] 2024-12-29 [â–¶] [ë‹¬ë ¥...]    â”‚
â”‚                              ^^^^^^^^^^^                   â”‚
â”‚                            (ë‚ ì§œ ì„ íƒ ì˜ì—­)                â”‚
â”‚                                                            â”‚
â”‚ ê²€ìƒ‰: [____________] [ğŸ”]  í•„í„°: [ì „ì²´ â–¼]                â”‚
â”‚                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚ â”‚ ===== ìƒˆ ëŒ€í™” ì„¸ì…˜: 14:35 =====                â”‚â†‘â”‚ â”‚
â”‚ â”‚ â”‚ [14:35:21][ê·“] ë‚˜ â†’ ìš°ë¥´ì‚¬: ì•ˆë…•í•˜ì„¸ìš”?       â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ [14:35:30][ê·“] ìš°ë¥´ì‚¬ â†’ ë‚˜: ë„¤ ì•ˆë…•í•˜ì„¸ìš”     â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ [14:36:15][íŒŒí‹°] í”Œë ˆì´ì–´1: ë˜ì „ ê°€ì‹¤ë¶„?      â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ [14:36:22][íŒŒí‹°] ë‚˜: ì €ìš”!                     â”‚ â”‚ â”‚
â”‚ â”‚ â”‚                                                â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ ===== ìƒˆ ëŒ€í™” ì„¸ì…˜: 18:20 =====                â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ [18:20:11][íŒŒí‹°] ë‚˜: í€˜ìŠ¤íŠ¸ ê°™ì´í•˜ì‹¤ë¶„         â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ [18:20:25][íŒŒí‹°] í”Œë ˆì´ì–´2: ë„µ ê°‘ì‹œë‹¤         â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ [18:21:03][íŒŒí‹°] í”Œë ˆì´ì–´3: ì €ë„ìš”            â”‚ â”‚ â”‚
â”‚ â”‚ â”‚                                                â”‚â†“â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚ [ë‚´ë³´ë‚´ê¸°] [ì„ íƒ ë‚ ì§œ ì‚­ì œ] [ëª¨ë‘ ì‚­ì œ]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ë‹¬ë ¥...] í´ë¦­ ì‹œ ë‚ ì§œ ë¸Œë¼ìš°ì € íŒì—…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë‚ ì§œ ì„ íƒ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ê²€ìƒ‰: [____________]                    â”‚
â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ â€¢ 2024-12-29 (1,234 ì¤„)         â†‘â”‚  â”‚
â”‚ â”‚ â€¢ 2024-12-28 (987 ì¤„)           â”‚ â”‚  â”‚
â”‚ â”‚ â€¢ 2024-12-27 (456 ì¤„)           â”‚ â”‚  â”‚
â”‚ â”‚ â€¢ 2024-12-26 (789 ì¤„)           â”‚ â”‚  â”‚
â”‚ â”‚ â€¢ 2024-12-25 (234 ì¤„)           â”‚ â”‚  â”‚
â”‚ â”‚ â€¢ 2024-12-24 (567 ì¤„)           â†“â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚        [ì„ íƒ]    [ì·¨ì†Œ]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ë‚´ë³´ë‚´ê¸°] í´ë¦­ ì‹œ íŒì—…:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì±„íŒ… ë¡œê·¸ ë‚´ë³´ë‚´ê¸°                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì•„ë˜ í…ìŠ¤íŠ¸ë¥¼ ë³µì‚¬í•˜ì—¬ ì €ì¥í•˜ì„¸ìš”:      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚ [ì—¬ê¸°ì— ë¡œê·¸ í…ìŠ¤íŠ¸ í‘œì‹œ]         â”‚  â”‚
â”‚ â”‚ Ctrl+Aë¡œ ì „ì²´ ì„ íƒ               â”‚  â”‚
â”‚ â”‚ Ctrl+Cë¡œ ë³µì‚¬                    â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              [ë‹«ê¸°]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. í•µì‹¬ êµ¬í˜„ ì½”ë“œ

### 5.1 FoxChatLogger.lua (ì„±ëŠ¥ ìµœì í™” ë²„ì „)
```lua
local addonName, addon = ...
addon.ChatLogger = addon.ChatLogger or {}
local CL = addon.ChatLogger

-- === ì„¤ì • ê¸°ë³¸ê°’ ===
CL.cfg = {
  enabled = false,
  channels = { WHISPER=true, PARTY=true, RAID=false, GUILD=false },
  retentionDays = 7,
  sessionTimeout = 1800,
}

-- ì±„ë„ ì½”ë“œ í…Œì´ë¸” (ì €ì¥ í¬ê¸° ìµœì†Œí™”)
local CH = {
  WHISPER_IN    = 2,
  WHISPER_OUT   = 1,
  PARTY         = 3,
  PARTY_LEADER  = 6,
  RAID          = 4,
  RAID_LEADER   = 7,
  GUILD         = 5,
}

local EVENT2CODE = {
  CHAT_MSG_WHISPER        = CH.WHISPER_IN,
  CHAT_MSG_WHISPER_INFORM = CH.WHISPER_OUT,
  CHAT_MSG_PARTY          = CH.PARTY,
  CHAT_MSG_PARTY_LEADER   = CH.PARTY_LEADER,
  CHAT_MSG_RAID           = CH.RAID,
  CHAT_MSG_RAID_LEADER    = CH.RAID_LEADER,
  CHAT_MSG_GUILD          = CH.GUILD,
}

-- ë‚ ì§œ í‚¤ ìºì‹± (í•«íŒ¨ìŠ¤ ìµœì í™”)
local curDayKey, curDayStart

local function InitDayCache()
  local now = GetServerTime()
  curDayKey = date("%Y%m%d", now)
  local y = tonumber(curDayKey:sub(1,4))
  local m = tonumber(curDayKey:sub(5,6))
  local d = tonumber(curDayKey:sub(7,8))
  curDayStart = time{year=y, month=m, day=d, hour=0}
end

InitDayCache()  -- ì´ˆê¸°í™”

-- ì±„ë„ í—ˆìš© í™•ì¸
local function ChannelAllowed(code)
  if code == CH.WHISPER_IN or code == CH.WHISPER_OUT then
    return CL.cfg.channels.WHISPER
  elseif code == CH.PARTY or code == CH.PARTY_LEADER then
    return CL.cfg.channels.PARTY
  elseif code == CH.RAID or code == CH.RAID_LEADER then
    return CL.cfg.channels.RAID
  elseif code == CH.GUILD then
    return CL.cfg.channels.GUILD
  end
  return false
end

-- ë©”ì‹œì§€ ì €ì¥ (í•«íŒ¨ìŠ¤ ìµœì í™” - date í˜¸ì¶œ ì œê±°)
local MAX_LINES_PER_DAY = 10000

local function SaveLog(ts, code, sender, target, msg, outgoing)
  if not CL.cfg.enabled then return end
  if not ChannelAllowed(code) then return end

  -- curDayKey ì‚¬ìš© (date í˜¸ì¶œ ì—†ìŒ)
  local bucket = FoxChatDB.chatLogs[curDayKey]
  if not bucket then
    bucket = {}
    FoxChatDB.chatLogs[curDayKey] = bucket
  end

  -- ì¼ë³„ ìµœëŒ€ ë¼ì¸ ìˆ˜ ì œí•œ
  if #bucket >= MAX_LINES_PER_DAY then
    table.remove(bucket, 1)  -- ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±°
  end

  -- ì¶•ì•½ í‚¤ë¡œ ì €ì¥
  bucket[#bucket+1] = {
    ts = ts,
    ch = code,
    s  = sender,
    t  = target,
    m  = msg,
    o  = outgoing and 1 or 0,
  }
end

-- ì˜¤ë˜ëœ ë¡œê·¸ ì‚­ì œ (ë¡œê·¸ì¸/ë‚ ì§œ ë³€ê²½ ì‹œ 1íšŒ)
function CL:CleanOldLogs()
  local keep = tonumber(CL.cfg.retentionDays) or 7
  keep = math.max(1, math.min(30, keep))
  local now = GetServerTime()

  for dayKey in pairs(FoxChatDB.chatLogs) do
    local y = tonumber(dayKey:sub(1,4))
    local m = tonumber(dayKey:sub(5,6))
    local d = tonumber(dayKey:sub(7,8))
    local t0 = time({year=y, month=m, day=d, hour=0, min=0, sec=0})
    if t0 and (now - t0) > keep * 86400 then
      FoxChatDB.chatLogs[dayKey] = nil
    end
  end
end

-- ìì • ë¡¤ì˜¤ë²„ ê°ì§€ (ìºì‹œ ì‚¬ìš©)
local function MaybeRolloverCached()
  local now = GetServerTime()
  if not curDayStart or now - curDayStart >= 86400 then
    InitDayCache()  -- ë‚ ì§œ í‚¤ ì¬ê³„ì‚°
    C_Timer.After(2, function() CL:CleanOldLogs() end)
  end
end

-- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (í†µí•©)
local f = CreateFrame("Frame")
CL.frame = f

-- ê·“ì†ë§ ëŒ€ìƒ ì¶”ì 
hooksecurefunc("SendChatMessage", function(msg, chatType, lang, target)
  if chatType == "WHISPER" and target and target ~= "" then
    CL.lastWhisperTarget = Ambiguate(target, "none"):gsub("%-.+$","")
  end
end)

f:SetScript("OnEvent", function(self, event, msg, sender, ...)
  local code = EVENT2CODE[event]
  if not code then
    if event == "PLAYER_LOGIN" then
      C_Timer.After(2, function() CL:CleanOldLogs() end)
    end
    return
  end

  local ts = GetServerTime()
  local target, outgoing

  if code == CH.WHISPER_OUT then
    outgoing = true
    target = CL.lastWhisperTarget  -- í›…ì—ì„œ ì¶”ì í•œ ëŒ€ìƒ ì‚¬ìš©
  end

  SaveLog(ts, code, sender, target, msg, outgoing)
  MaybeRolloverCached()  -- ìì • ì²´í¬ (ìºì‹œ ì‚¬ìš©)
end)

-- ì´ë²¤íŠ¸ ë“±ë¡
f:RegisterEvent("PLAYER_LOGIN")
f:RegisterEvent("CHAT_MSG_WHISPER")
f:RegisterEvent("CHAT_MSG_WHISPER_INFORM")
f:RegisterEvent("CHAT_MSG_PARTY")
f:RegisterEvent("CHAT_MSG_PARTY_LEADER")
f:RegisterEvent("CHAT_MSG_RAID")
f:RegisterEvent("CHAT_MSG_RAID_LEADER")
f:RegisterEvent("CHAT_MSG_GUILD")

-- 5ë¶„ë§ˆë‹¤ ìì • ì²´í¬ (ì±„íŒ… ì—†ëŠ” ì‹œê°„ëŒ€ ëŒ€ë¹„)
local ticker = C_Timer.NewTicker(300, MaybeRolloverCached)
```

### 5.2 UI ë Œë”ë§ (ì„¸ì…˜ êµ¬ë¶„)
```lua
-- UIì—ì„œë§Œ í¬ë§· ìˆ˜í–‰
local function FormatLine(entry, prevTs, sessionTimeout)
  local lines = {}

  -- ì„¸ì…˜ êµ¬ë¶„ (30ë¶„ ì´ìƒ ê°„ê²©)
  if prevTs and (entry.ts - prevTs) > (sessionTimeout or 1800) then
    lines[#lines+1] = ("===== ìƒˆ ëŒ€í™” ì„¸ì…˜: %s ====="):format(date("%H:%M", entry.ts))
  end

  local ch = entry.ch
  local chLabel = (ch==1 or ch==2) and "ê·“"
                or (ch==3 or ch==6) and "íŒŒí‹°"
                or (ch==4 or ch==7) and "ê³µëŒ€"
                or (ch==5) and "ê¸¸ë“œ"
                or "ê¸°íƒ€"

  local who
  if ch==1 then
    who = ("ë‚˜ â†’ %s"):format(entry.t or "?")
  elseif ch==2 then
    who = ("%s â†’ ë‚˜"):format(entry.s or "?")
  else
    who = entry.s or "?"
  end

  lines[#lines+1] = ("[%s][%s] %s: %s"):format(
    date("%H:%M:%S", entry.ts),
    chLabel,
    who,
    entry.m or ""
  )

  return table.concat(lines, "\n")
end
```

### 5.3 ë¹„ë™ê¸° ê²€ìƒ‰ (í”„ë ˆì„ ë“œë¡­ ë°©ì§€)
```lua
local function SearchAsync(entries, keyword, onProgress, onComplete)
  local i, n, step = 1, #entries, 300
  local results = {}

  local function tick()
    local stop = math.min(i + step - 1, n)
    for k = i, stop do
      if string.find(entries[k].m or "", keyword, 1, true) then
        results[#results+1] = k
      end
    end

    if onProgress then
      onProgress(stop/n)  -- ì§„í–‰ë¥  ì½œë°±
    end

    i = stop + 1
    if i <= n then
      C_Timer.After(0, tick)  -- ë‹¤ìŒ í”„ë ˆì„ì— ê³„ì†
    else
      if onComplete then
        onComplete(results)
      end
    end
  end

  tick()
end
```

### 5.4 ë‚ ì§œ ì„ íƒ UI (Prev/Next ë°©ì‹)
```lua
-- ë‚ ì§œ ì´ë™ í•¨ìˆ˜
local function ShiftDay(dayKey, delta)
  local y = tonumber(dayKey:sub(1,4))
  local m = tonumber(dayKey:sub(5,6))
  local d = tonumber(dayKey:sub(7,8))
  local t = time{year=y, month=m, day=d, hour=0}
  local t2 = t + delta * 86400
  return date("%Y%m%d", t2)
end

-- ë‚ ì§œ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼
local function CreateDateNav(parent)
  local frame = CreateFrame("Frame", nil, parent)
  frame:SetSize(300, 30)

  -- ì˜¤ëŠ˜ ë²„íŠ¼
  local todayBtn = CreateFrame("Button", nil, frame, "UIPanelButtonTemplate")
  todayBtn:SetSize(50, 25)
  todayBtn:SetPoint("LEFT", 0, 0)
  todayBtn:SetText("ì˜¤ëŠ˜")
  todayBtn:SetScript("OnClick", function()
    local today = date("%Y%m%d")
    if FoxChatDB.chatLogs[today] then
      SelectDay(today)
    end
  end)

  -- ì–´ì œ ë²„íŠ¼
  local yesterdayBtn = CreateFrame("Button", nil, frame, "UIPanelButtonTemplate")
  yesterdayBtn:SetSize(50, 25)
  yesterdayBtn:SetPoint("LEFT", todayBtn, "RIGHT", 5, 0)
  yesterdayBtn:SetText("ì–´ì œ")

  -- ì´ì „ ë‚ ì§œ ë²„íŠ¼
  local prevBtn = CreateFrame("Button", nil, frame, "UIPanelButtonTemplate")
  prevBtn:SetSize(25, 25)
  prevBtn:SetPoint("LEFT", yesterdayBtn, "RIGHT", 10, 0)
  prevBtn:SetText("â—€")
  prevBtn:SetScript("OnClick", function()
    local dk = ShiftDay(UIState.selectedDayKey, -1)
    if FoxChatDB.chatLogs[dk] then
      SelectDay(dk)
    end
  end)

  -- ë‚ ì§œ í‘œì‹œ
  local dateLabel = frame:CreateFontString(nil, "OVERLAY", "GameFontNormal")
  dateLabel:SetPoint("LEFT", prevBtn, "RIGHT", 5, 0)
  dateLabel:SetText("2024-12-29")
  frame.dateLabel = dateLabel

  -- ë‹¤ìŒ ë‚ ì§œ ë²„íŠ¼
  local nextBtn = CreateFrame("Button", nil, frame, "UIPanelButtonTemplate")
  nextBtn:SetSize(25, 25)
  nextBtn:SetPoint("LEFT", dateLabel, "RIGHT", 5, 0)
  nextBtn:SetText("â–¶")
  nextBtn:SetScript("OnClick", function()
    local dk = ShiftDay(UIState.selectedDayKey, +1)
    if FoxChatDB.chatLogs[dk] then
      SelectDay(dk)
    end
  end)

  -- ë‹¬ë ¥ ë²„íŠ¼
  local calendarBtn = CreateFrame("Button", nil, frame, "UIPanelButtonTemplate")
  calendarBtn:SetSize(60, 25)
  calendarBtn:SetPoint("LEFT", nextBtn, "RIGHT", 10, 0)
  calendarBtn:SetText("ë‹¬ë ¥...")
  calendarBtn:SetScript("OnClick", function()
    ShowDateBrowser()  -- ë‚ ì§œ ë¸Œë¼ìš°ì € íŒì—…
  end)

  return frame
end
```

### 5.5 ê°€ìƒ ìŠ¤í¬ë¡¤ êµ¬í˜„ (FauxScrollFrame - Classic í˜¸í™˜)
```lua
-- Classic í˜¸í™˜ ìŠ¤í¬ë¡¤ í”„ë ˆì„
local function CreateLogViewer(parent)
  local frame = CreateFrame("Frame", nil, parent)
  frame:SetSize(500, 300)

  -- ìŠ¤í¬ë¡¤ í”„ë ˆì„
  local scroll = CreateFrame("ScrollFrame", nil, frame, "FauxScrollFrameTemplate")
  scroll:SetPoint("TOPLEFT", 0, 0)
  scroll:SetPoint("BOTTOMRIGHT", -30, 0)

  -- í‘œì‹œ ì˜ì—­
  local content = CreateFrame("Frame", nil, scroll)
  content:SetSize(470, 300)
  scroll:SetScrollChild(content)

  -- ë¼ì¸ ë²„íŠ¼ë“¤ (ì¬ì‚¬ìš©)
  local lines = {}
  local LINE_HEIGHT = 14
  local MAX_LINES = 20

  for i = 1, MAX_LINES do
    local line = content:CreateFontString(nil, "OVERLAY", "GameFontNormalSmall")
    line:SetPoint("TOPLEFT", 5, -(i-1) * LINE_HEIGHT)
    line:SetPoint("RIGHT", -5, 0)
    line:SetJustifyH("LEFT")
    line:SetHeight(LINE_HEIGHT)
    lines[i] = line
  end

  -- ì—…ë°ì´íŠ¸ í•¨ìˆ˜
  local function UpdateList(data)
    local offset = FauxScrollFrame_GetOffset(scroll)
    for i = 1, MAX_LINES do
      local dataIndex = i + offset
      if dataIndex <= #data then
        lines[i]:SetText(data[dataIndex])
        lines[i]:Show()
      else
        lines[i]:Hide()
      end
    end
    FauxScrollFrame_Update(scroll, #data, MAX_LINES, LINE_HEIGHT)
  end

  frame.UpdateList = UpdateList
  return frame
end
```

## 6. êµ¬í˜„ íŒŒì¼ êµ¬ì¡°

### 6.1 ìƒˆë¡œ ìƒì„±í•  íŒŒì¼
- `FoxChatLogger.lua` - ì±„íŒ… ë¡œê·¸ í•µì‹¬ ëª¨ë“ˆ (ìœ„ ì½”ë“œ)
- `FoxChat_Config_ChatLog.lua` - UI êµ¬ì„±

### 6.2 ìˆ˜ì •í•  íŒŒì¼
- `FoxChat.toc` - ìƒˆ íŒŒì¼ ì¶”ê°€
- `FoxChat_Config_TabUI.lua` - ì±„íŒ… ë¡œê·¸ íƒ­ ì¶”ê°€

## 7. ì„±ëŠ¥ ê°€ì´ë“œ

### 7.1 ì˜ˆìƒ ì„±ëŠ¥
- **ë¡œê·¸ ì €ì¥ ì˜¤ë²„í—¤ë“œ**: ì´ë²¤íŠ¸ë‹¹ í…Œì´ë¸” 1ê°œ + í•„ë“œ ëª‡ ê°œ â†’ ë¬¸ì œì—†ìŒ
- **ë©”ëª¨ë¦¬ ì‚¬ìš©**: 1,000ì¤„ â‰ˆ ìˆ˜ë°± KB (í•œêµ­ì–´ UTF-8 ê¸°ì¤€)
- **ê¶Œì¥ ì„¤ì •**: 7~14ì¼ ë³´ê´€, RAID/GUILD ê¸°ë³¸ OFF â†’ ìˆ˜ MB ì´í•˜ ìœ ì§€

### 7.2 SavedVariables ê´€ë¦¬
- **ë””ìŠ¤í¬ ì €ì¥ ì‹œì **: /reload ë˜ëŠ” ë¡œê·¸ì•„ì›ƒ ì‹œì—ë§Œ
- **ìì • ì²˜ë¦¬**: ë©”ëª¨ë¦¬ì—ì„œ ë²„í‚· êµì²´ë§Œ (ë””ìŠ¤í¬ ì €ì¥ X)
- **í¬ê¸° ì œí•œ**: ìˆ˜ì‹­ MB ë„˜ì§€ ì•Šë„ë¡ ë³´ê´€ ê¸°ê°„ ì œí•œ

## 8. ê°œë°œ ìˆœì„œ

### Phase 1: í•µì‹¬ êµ¬ì¡° (1ì¼)
1. FoxChatLogger.lua ê¸°ë³¸ êµ¬ì¡°
2. ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í†µí•©
3. ì¶•ì•½ í‚¤ ì €ì¥ êµ¬ì¡°

### Phase 2: ë¡œê¹… ê¸°ëŠ¥ (1ì¼)
1. ë©”ì‹œì§€ ìˆ˜ì§‘/ì €ì¥ (epoch timestamp)
2. ìì • ë¡¤ì˜¤ë²„ (ë©”ëª¨ë¦¬ë§Œ)
3. ì˜¤ë˜ëœ ë¡œê·¸ ì •ë¦¬ (ë¡œê·¸ì¸ ì‹œ)

### Phase 3: UI êµ¬í˜„ (2ì¼)
1. ì„¤ì • UI (ì²´í¬ë°•ìŠ¤, ë“œë¡­ë‹¤ìš´)
2. ê°€ìƒ ìŠ¤í¬ë¡¤ ë·°ì–´ (HybridScrollFrame)
3. ì„¸ì…˜ êµ¬ë¶„ í‘œì‹œ (UIë‹¨)
4. ë‚ ì§œ ì„ íƒê¸°

### Phase 4: ë¶€ê°€ ê¸°ëŠ¥ (1ì¼)
1. ë¹„ë™ê¸° ê²€ìƒ‰ (ì²­í¬ ì²˜ë¦¬)
2. ë‚´ë³´ë‚´ê¸° (EditBox ë³µì‚¬)
3. í•„í„°ë§
4. í…ŒìŠ¤íŠ¸

## 9. í…ŒìŠ¤íŠ¸ ê³„íš

### 9.1 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- 1ë§Œ ì¤„ ë¡œê·¸ì—ì„œ ê²€ìƒ‰ ì†ë„
- ìŠ¤í¬ë¡¤ ì‹œ í”„ë ˆì„ ë ˆì´íŠ¸
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
- ìì • ë¡¤ì˜¤ë²„ ë™ì‘

### 9.2 ì•ˆì •ì„± í…ŒìŠ¤íŠ¸
- ê°•ì œ ì¢…ë£Œ ì‹œ ë°ì´í„° ìœ ì‹¤ í™•ì¸
- /reload í›„ ë°ì´í„° ì§€ì†ì„±
- ëŒ€ëŸ‰ ë©”ì‹œì§€ ë™ì‹œ ìˆ˜ì‹ 
- ë‹¤êµ­ì–´ ë¬¸ì ì²˜ë¦¬

## 10. ì£¼ì˜ì‚¬í•­

### 10.1 WoW í´ë˜ì‹ ì œì•½
- ì• ë“œì˜¨ì€ íŒŒì¼ ì§ì ‘ ì €ì¥ ë¶ˆê°€
- SavedVariablesëŠ” ë¡œê·¸ì•„ì›ƒ/ë¦¬ë¡œë“œ ì‹œë§Œ ì €ì¥
- ê°•ì œ ì €ì¥ API ì—†ìŒ

### 10.2 ì„±ëŠ¥ ìµœì í™” í•„ìˆ˜
- ë¬¸ìì—´ í¬ë§·ì€ UIì—ì„œë§Œ
- ì¶•ì•½ í‚¤ë¡œ ì €ì¥ í¬ê¸° ìµœì†Œí™”
- ê°€ìƒ ìŠ¤í¬ë¡¤ë¡œ ë Œë”ë§ ìµœì í™”
- ê²€ìƒ‰ì€ ë¹„ë™ê¸° ì²˜ë¦¬

## 11. ì˜ˆìƒ ë¬¸ì œ ë° í•´ê²°ë°©ì•ˆ

| ë¬¸ì œ | ì›ì¸ | í•´ê²°ë°©ì•ˆ |
|------|------|----------|
| í”„ë ˆì„ ë“œë¡­ | ëŒ€ëŸ‰ ë°ì´í„° í•œë²ˆì— ì²˜ë¦¬ | ì²­í¬ ì²˜ë¦¬, C_Timer í™œìš© |
| SavedVariables í¬ê¸° | ê¸´ í‚¤ëª…, ë¬¸ìì—´ íƒ€ì„ìŠ¤íƒ¬í”„ | ì¶•ì•½ í‚¤, epoch ìˆ«ì ì €ì¥ |
| ìì • ë°ì´í„° ìœ ì‹¤ | ìë™ ì €ì¥ ê¸°ëŒ€ | ë©”ëª¨ë¦¬ ë²„í‚· êµì²´ë§Œ, ì €ì¥ì€ ë¦¬ë¡œë“œ ì‹œ |
| ê·“ë§ ëŒ€ìƒ ì¶”ì¶œ ì‹¤íŒ¨ | WHISPER_INFORM ì´ë²¤íŠ¸ ì œì•½ | SendChatMessage í›…ìœ¼ë¡œ ëŒ€ìƒ ì¶”ì  |
| ë‚´ë³´ë‚´ê¸° ë¶ˆê°€ | íŒŒì¼ ì €ì¥ API ì—†ìŒ | EditBox íŒì—…ìœ¼ë¡œ ë³µì‚¬ ìœ ë„ |
| ë‚ ì§œ ì„ íƒ UI ë¶€ë‹´ | ë‚ ì§œ ë§ì•„ì§€ë©´ ë“œë¡­ë‹¤ìš´ ë¹„íš¨ìœ¨ | Prev/Next ë²„íŠ¼ + ë‚ ì§œ ë¸Œë¼ìš°ì € íŒì—… |
| í•«íŒ¨ìŠ¤ date() í˜¸ì¶œ | ë§¤ ë©”ì‹œì§€ë§ˆë‹¤ ë‚ ì§œ ê³„ì‚° | dayKey ìºì‹±ìœ¼ë¡œ date() í˜¸ì¶œ ìµœì†Œí™” |
| ë©”ëª¨ë¦¬ í­ì¦ | ì¼ë³„ ë¡œê·¸ ë¬´ì œí•œ | MAX_LINES_PER_DAY ì œí•œ (10,000ì¤„) |

## 12. ì™„ì„± ì˜ˆìƒ íš¨ê³¼
- ì¼ì¼ ëŒ€í™”ëŸ‰ ì•½ 500~1,000ì¤„ ê¸°ì¤€ ì•ˆì •ì  ë™ì‘
- 7ì¼ ë³´ê´€ ì‹œ ì•½ 1~2MB SavedVariables ì‚¬ìš©
- í”„ë ˆì„ ë“œë¡­ ì—†ëŠ” ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤
- ë¹ ë¥¸ ê²€ìƒ‰ (1ë§Œ ì¤„ ê¸°ì¤€ 1ì´ˆ ì´ë‚´)